<!DOCTYPE HTML>
<html>
    <head>
        <meta content="text/html; charset=UTF-8" http-equiv="content-type">
        <title>Интерактивная схема алгоритма Эль Гамаля</title>
        <link type="text/css" rel="stylesheet" href="css/normalize.css"/>
        <link type="text/css" rel="stylesheet" href="css/style.css"/>
    </head>
    <body>

    <nav id = "header">
        <div id = "title">Алгоритм Эль Гамаля</div>

        <ul id = "menu">
            <li>
                <a href = "#introduction" class = "nav-link">Введение</a>
            </li>
            <li>
                <a href = "#theory" class = "nav-link">Теория</a>
            </li>
            <li>
                <a href = "#theory-chipher" class = "nav-link">Шифрование</a>
            </li>
            <li>
                <a href = "#interactive" class = "nav-link">Интерактивная схема</a>
            </li>
            <li>
                <a href = "#links" class = "nav-link">Источники</a>
            </li>
            <li>
                <a href = "https://github.com/The220th/DM2020_AltExam_ElGamalEncryption" class = "nav-link">Github проект</a>
            </li>
        </ul>
    </nav>

    <div id="wrapper">
        <div id = "introduction" class="block">
            <h1 class = "title">Введение</h1>
            <p class = "text">
                Цель алгоритмов шифрования - помочь людям обмениваться секретной или конфиденциальной информацией друг с другом, используя информационный эквивалент физических ключей. Чтобы облегчить обсуждение, мы скажем, что Боб хочет послать Алисе сообщение, чтобы Ева не смогла его увидеть. С симметричным алгоритмом шифрования ключ, используемый для шифрования сообщения, совпадает с ключом, используемым для его расшифровки. Это аналогично тому, как Боб помещает свое сообщение в ящик, закрывает его и отправляет Алисе для открытия. Большая проблема с таким подходом состоит в том, что Алиса нуждается в копии ключа, который использовал Боб. Это проблема курицы и яйца: для безопасного обмена информацией друг с другом Алиса и Боб уже должны были обмениваться секретной информацией. Если Боб когда-нибудь отправит ключ Алисе, Ева может легко перехватить его и использовать для чтения своих сообщений. Теоретически, Боб может дать Алисе ключ лично, но на практике это не очень хорошо работает. Представьте, что вам нужно ехать в офис какой-либо компании, чтобы дать им номер вашей кредитной карты, прежде чем вы сможете что-то купить онлайн. Это ужасно неудобно!
                <br/>
                <br/>
                Решением проблемы являются алгоритмы асимметричного шифрования,
                которые не используют один и тот же ключ для шифрования и дешифрования.
                Продолжая нашу аналогию с ящиками и физическими ключами, Алиса отправляет
                разблокированный замок всем, кто хочет отправлять ей сообщения.
                Боб кладет свое сообщение в ящик, запирает его замком Алисы и отправляет обратно Алисе.
                Поскольку Алиса - единственная, у кого есть ключ от замка,
                только она может прочитать сообщение, как только оно окажется в запертом ящике.
                Алгоритм Эль Гамаля является примером информационного алгоритма,
                который работает по этому принципу.
                В основу криптографической системы Эль Гамаля
                положена сложность задачи вычисления дискретных логарифмов в конечном поле.
                Существуют эффективные алгоритмы возведения числа в степень в конечном поле,
                однако восстановление показателя (дискретного логарифма) по известному
                основанию и его степени является сложной математической задачей.
                На сегодняшний день не известно ни одного эффективного алгоритма
                вычисления дискретных логарифмов больших чисел
            </p>
        </div>

        <div id="theory" class = "block">
            <h1 class = "title">Немного вводной теории</h1>
            <p class = "text">
                Перед тем, как мы познакомимся с алгоритмом Эль Гамаля, мы должны понять несколько базовых вещей.
            </p>
            <div class = "example">
                <h3 class = "border_title">Сравнения</h3>
                <p class = "text">
                <strong>Сравнение двух целых чисел по модулю натурального числа m</strong> — математическая операция,
                позволяющая ответить на вопрос о том, дают ли два выбранных целых числа
                при делении на m один и тот же остаток.<br/>
                Попробуйте:
                </p>
                <div>
                    <div class = "modulo_example">
                        <div><input id="c1" class="input_int" tabindex="1"></div>
                        <div><span>mod</span></div>
                        <div><input id="c2" class="input_int" tabindex="2"></div>
                        <div><input type="button" onclick="modulo_example()" value=" = " class="button_calc" tabindex="3"></div>
                        <div><div class="art" id="ans"></div></div>
                    </div>
                </div>
                <p class = "text">
                Операция сравнения по модулю является неотъемлемой частью многих систем шифрования.
                Главное свойство, которое делает сравнение по модулю настолько полезным для алгоритмов шифрования,
                заключается в том, что результат операции не раскрывает никакой информации о a.
                </p>
                <p class = "text">
                    Узнайте больше про модульную арифетику на
                    <a href = "https://ru.wikipedia.org/wiki/%D0%A1%D1%80%D0%B0%D0%B2%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D0%BE_%D0%BC%D0%BE%D0%B4%D1%83%D0%BB%D1%8E"><strong>Wikipedia</strong></a>.
                </p>
            </div>
            <div class = "example">
                <h3 class = "border_title">Конечные циклические группы и подгруппы</h3>
                <p class = "text">
                <strong>Циклическая группа</strong> — это математическая группа, порожденная одним из элементов в группе G.
                Так как мы будем говорить об алгоритме Эль Гамаля, то нас интересуют только два типа групп:
                </p>
                <ul class = "list">
                    <li>
                        Группа целых чисел от 1 до p-1 по операции умножения (mod p)
                        для некоторого простого числа p, которое известно как Z∗p
                    </li>
                    <li>
                        Подгруппы Z∗p простого порядка
                    </li>
                </ul>
                Добавить интерактивную генерацию групп
                <p class = "text">
                    Узнайте больше о циклических группах на
                    <a href = "https://ru.wikipedia.org/wiki/%D0%A6%D0%B8%D0%BA%D0%BB%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B0%D1%8F_%D0%B3%D1%80%D1%83%D0%BF%D0%BF%D0%B0"><strong>Wikipedia</strong></a>.
                </p>
            </div>
        </div>

        <div id = "theory-chipher" class="block">
            <h1 class = "title">Работа в режиме шифрования</h1>
            <p class = "text">
                Алиса хочет, чтобы люди могли отправлять ей секретные сообщения, поэтому она создает открытый ключ (р, g, h),
                которым она делится с миром и личный ключом x, который она никогда никому не рассказывает.
                Боб хочет отправить Алисе секретное сообщение, поэтому он использует открытый ключ Алисы и одноразовый сессионный ключ R, создает зашифрованный текст (s1 , s2).<br/>
                Вот как это работает:
            </p>
            <div class="example">
                <p class="alice-column-start">
                    <img src="images/Alice.svg" alt="Alice" />
                </p>
                <p class="bob-column-start">
                    <img src="images/Bob.svg" alt="Bob" />
                </p>
                <p class="alice-column">1.Алиса выбирает простое число p</p>
                <p class="alice-column">2.Выбирает целое число G, такое, что G - первообразный корень P,
                    который генерирует циклическую подгруппу порядка n</p>
                <p class="alice-column">3.Выбирает случайный секретный ключ, такой что 1 <= x <= N-1.</p>
                <p class="alice-column">3.Вычисляет H = G^X mod P</p>
                <p class="alice-column send-right">5.Публикует открытый ключ (p,g,h).</p>
                <p class="bob-column">1.Смотрит на ключ Алисы (p,g,y).</p>
                <p class="bob-column">2.Боб выбирает случайное R, такое что 1 <= R <= N - 1</p>
                <p class="bob-column">3.Создает сообщение m, такое что 0 < m < p. Если сообщение слишком большое, то
                Боб делит сообщение на части и шифрует их отдельно.</p>
                <p class="bob-column">4.Вычисляет числа s1 = G^R mod P, s2 = (H^R)*M mod P.</p>
                <p class="bob-column send-left">5.Боб публикует шифр текст (s1, s2).</p>
                <p class="alice-column">6.Алиса видит шифртекст (s1, s2).</p>
                <p class="alice-column">7.Расшифровывает сообщение m = s1^(-x)*s2 mod P.</p>
            </div>
        </div>

        <div id = "interactive" class="block">
            <h1 class = "title">Интерактивная схема</h1>
            <p class = "text">
                Это небольшое приложение, которое вы можете использовать,
                чтобы попробовать шифрование Эль Гамаля.<br>
                Это игрушечная реализация, поэтому, пожалуйста, даже не пытайтесь
                использовать большие числа))
            </p>
            <div class="row">
                <div class="col">
                    <div class = "machine" id="aliceMachine">
                        <div class="machine-title-panel">
                            <h3 class="machine-title">Алиса</h3>
                        </div>
                        <div class = "machine-main">
                            <ul class="errors"></ul>
                            <form>
                              <div class="form-group" id="prime">
                                <label for="txtPrime">
                                  Введите простое число P
                                </label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="txtPrime"/>
                                    <button id="getGenerators" class="btn" type="button">Ввести</button>
                                </div>
                                <span class="errorInfo">Данное число не является простым</span>
                              </div>

                              <div class="form-group" id="generator">
                                <label for="txtG">
                                  Выберете примитивный корень G
                                </label>
                                <div id="generatorInfo">Нажмите на кнопку выше, чтоб увидеть спиcок примитивных корней</div>
                                <div id="selectG"></div>
                                <span class="errorInfo">Ошибка</span>
                              </div>

                              <div class="form-group" id="privateKey">
                                <label for="txtPrivateKey">
                                  Введите приватный ключ X
                                </label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="txtPrivateKey"/>
                                    <button id="getRandomPrivateKey" class="btn" type="button">Рандом</button>
                                </div>
                                <span class="errorInfo">Число должно быть больше 0 и меньше (P-1)</span>
                              </div>

                              <div class="form-group">
                                  <button id="getPublicKey" class = "btn" type="button">
                                    Сгенерировать и Опубликовать Открытый ключ
                                  </button>
                              </div>
                            </form>
                        </div>

                        <div class="message">
                            <div id="messageDisplay">
                              <div class="inbox-empty" style="display: block">
                                У вас нет сообщений.
                              </div>
                              <div class="inbox-has-message" style="display: none">
                                <div>Вы получили сообщение от Боба. <button id="decrypt" class="btn btn-primary btn-sm" type="button">Расшифровать</button></div>
                                <div class="data" style="font-weight: bold;margin-top:10px;"></div>
                              </div>
                            </div>
                        </div>

                        <div class="extrainfo"></div>
                    </div>
            </div>
            <!-- ТАБЛИЦА ДАННЫХ -->

                <div class="col">
                    <div id="wire">
                        <div class="wire-data">
                            <div id="keyDisplay" class="display">
                                Публичный ключ<br/>
                                <span class="data">-</span>
                            </div>

                            <div id="encryptedMsg" class="display">
                                Зашифрованное сообщение<br/>
                                <span class="data">-</span>
                            </div>
                        </div>
                    </div>
                </div>

            <!-- ВТОРОЙ АБОНЕНТ -->

            <div class="col">
                <div class="machine" id="bobMachine">
                    <div class="machine-title-panel">
                        <h3 class="machine-title">Боб</h3>
                    </div>
                <div class="machine-main">
                  <form>
                    <div class="form-group" id="encryptPrivate">
                      <label for="txtEncryptPrivate">
                        Введите закрытый ключ для шифрования R
                      </label>
                      <div class="input-group">
                        <input type="text" class="form-control" id="txtEncryptPrivate"/>
                        <div class="input-group-btn">
                          <button id="getRandomEncyptKey" class="btn" type="button">Рандом</button>
                        </div>
                      </div>
                      <span class="errorInfo">Число должно быть больше 0 и меньше (P - 1)</span>
                    </div>

                    <div class="form-group" id="message">
                      <label for="txtMessage">
                        Сообщение M
                      </label>
                      <div class="input-group">
                            <input type="text" class="form-control" id="txtMessage"/>
                            <button id="encrypt" class="btn" type="button">
                                Отправить
                            </button>
                        </div>
                      <span class="errorInfo">Число должно быть больше 0 и меньше P.</span>
                    </div>

                  </form>
                  <div class="extrainfo"></div>
                </div>
              </div>
            </div>

        </div>
    </div>

    <div id = "theory-signature" class="block">
        <h1 class = "title">Работа в режиме подписи</h1>
        <h2 class = "subtitle">Подпись сообщений</h2>
        <p class = "text">
            Для подписи сообщения M выполняются следующие операции:  <br>
            1) Вычисляется дайджест сообщения M: m = h(M) (Хеш-функция может быть любой) <br>
            2) Выбирается случайное число 1 < k < p-1 взаимнопростое с p-1 и вычисляется r = g^k(mod p) <br>
            3) Вычисляется число s = (m - xr)k^-1(mod p-1) <br>
            4) Подписью сообщения M является пара (r,s) <br>
        </p>
        <h2 class = "subtitle">Проверка подписи</h2>
        <p class = "text">
            Зная открытый ключ (p,g,h), подпись (r,s) сообщения M проверяется следующим образом: <br>
            1) Проверяется выполнимость условий: 0 < r < p и 0 < s < p-1 <br>
            2) Вычисляется дайджест сообщения M: m = h(M) <br>
            3) Подпись считается верной, если выполняется сравнение: y^r*r^s == g^m (mod p)<br>
            <br>
        </p>
    </div>

    <div id = "attacks" class="block">
        <h1 class = "title">Атакуем алгоритм</h1>
        <p class = "text">
            <img src = "images/Eve.svg"/>
            Пока Алиса и Боб обменивались секретиками, Ева чувствовала себя брошенной.
            Она решила научиться читать сообщения друзей. Давайте поможем ей в этом интересном занятии!
        </p>
        <h2 class = "subtitle">Атака одинаковых сессионных ключей</h2>
        <p class = "text">
            Пока Боб ненадолго отлучился, хитрая Ева смогла подсмотреть в переписку. Она увидела то, что все сообщения шифруются при помощи одного и того же сессионного ключа. Кроме того, она смогла запомнить одно из сообщений.
            <br/>
            <br/>
            Такого набора данных хватит, чтоб Ева спокойно могла прочитать любое сообщение, которое будет отправлено с данными параметрами.
            <br/>
            <br/>
            Предположим, что при отправке двух разных сообщений m и m' был использован один и тот же секретный ключ k. (Параметры p,g,h,x тоже одинаковые).  Тогда рассмотрим шифртекст, который получается в таком случае
            m: s1 = g^k mod p, s2 = m*(h^k) mod p
            m': s1' = g^k mod p, s2' = m'*(h^k) mod p
            <br/>
            <br/>
            Во-первых, s2'/s2= m'/m => m' = (s2'/s2')*m. Ура! При помощи такой формулы мы спокойно можем получить информацию о другом сообщении, которое было передано с таким же k.
            Во-вторых, если мы перебором вычислим k, то мы сможем узнать и секретный ключ по формуле ...  А это позволит не только расшифровывать все сообщения, но и подписывать сообщения!
            <br/>
            <br/>
            Когда мы рассказали Еве о данной атаке, она была на седьмом небе от счастья. Но недолго она оставалась такой: Алиса и Боб догадались о том, что их сообщения были прочитаны, поэтому они устранили уязвимость: решили каждый раз генерировать случайный сессионный ключ. Но при этом они продолжили использовать относительно маленькие числа для ключей. Этим мы и воспользуемся!
        </p>
        <h2 class = "subtitle">Атака малого модуля</h2>
        <p class = "text">
            Атака состоит в том, что мы будем искать решение h = g^x mod p, зная h, g и p (помним, что параметры имеют относительно малое значение), алгоритмом baby step giant step.
            <br/>
            <br/>
            Пусть есть уравнение h = g^x в цикличекой группе порядка p. Положим, что x = i*m - j, где m - заранее выбранная константа (обычно используют округленное вверх значение квадратного корня из p). i называют giant step, т.к увеличение параметра увеличивает x на m, а i - baby step (противоположность giant step).
            Очевидно, что любое x из промежутка [0,p) можно представить в такой форме. Тогда уравение принимает вид: h = g^(m*i - j) => h*(g^(-m))^i = g^j
            Алгоритм предварительно вычисляет g^j для некоторых j. Потом корректируется значение m и пробуются различные значения i.
            <br/>
            <br/>
            Давайте рассмотрим пример:<br/>
            20 = 5^x (mod 53)<br/>
            В данном случае  g = 5, h = 20 и p = 53, и мы хотим узнать x. Для начала определим квадратный корень из p-1, и округлим до ближайшего целого:<br/>
            m = ceil(sqrt(p-1)) = ceil(sqrt(52)) = 7<br/>
            Затем мы вычислим g^j (mod p) от 1 до m и занесем информацию в виде {g^j (mod p), j}<br/>
            {1: 0, 5: 1, 25: 2, 11: 3,  42: 4, 51: 5,  43: 6, 3: 7}<br/>
            Например: Если i = 0, мы получаем 5^6 mod 53 дает 43 {43:6}<br/>
            Теперь у нас есть список пар от 0 до квадратного корня из p-1.  Затем мы проходимся по значениям h (g^-m)^x (mod p) пока мы не найдем совпадения в таблице. Тогда мы умножаем число на m и добавляем число, которое сопоставлено в таблице.<br/>
            <br/>
            Тут уже сложно использовать ручные вычисления, поэтому мы написали простую программу для Евы.
            <br/>
            Добавить программу
        </p>
        <h2 class = "subtitle">Атака Meet in the Middle</h2>
        <p class = "text">
            Очередная атака, которую мы попробуем называется Meet in the Middle (встреча в середине).
            Не стоит путать эту атаку с Man in the Middle (человек по середине), в которой Ева
            притворяется Алисой и Бобом, читающая сообщения, которые Боб шифрует своим ключом,
            вместо Алисы, и отправляющую сообщения Алисе после шифрования их ключом Алисы.
            <br/>
            Если соблюдается ряд условий и сообщение m, которое Боб посылает Алисе, достаточно короткое,
            то Ева может восстановить m, если она сможет перехватить s2,
            когда Боб посылает свой шифротекст Алисе.
            В частности, Meet in the Middle работает только в том случае, если:
        </p>
        <ul class = "list">
            <li>
                m состоит из B бит, причем Ева знает B, и B является небольшим числом.
            </li>
            <li>
                m можно разделить на две части таким образом, что m=(m1)(m2).
                Пусть m1 состоит из битов b1, а m2 - из битов b2.
            </li>
            <li>
                Ева знает n. Поскольку сессионный ключ Боба k обладает свойством 1 ≤ k ≤ n-1,
                ему также необходимо каким-то образом определить n. Если он может, то Ева может тоже.
            </li>
            <li>
                m не является элементом подгруппы, порожденной g.
                Это кажется совершенно маловероятным. Однако, порядок n подгруппы, генерируемой g,
                часто выбирается небольшим по соображениям эффективности.
            </li>
            <li>
                Порядок n подгруппы, порожденной g, имеет свойство, что n ≤ (p-1)*2^−b.
                Опять же, возможно, что n мало по соображениям эффективности.
            </li>
        </ul>
        <p class = "text">
            Если все магическим образом будут выполнены все условия,то Ева может действовать следующем образом: <br/>
            Она знает, что h = g^x (mod p) <br/>
            и что s2 = m*(h^r) (mod p) <br/>
            Возведем обе части в степень n: s2^n = (m^n)*(h^nr) (mod p) <br/>
            Это бесполезно как часть атаки, если m является элементом подгруппы, порожденной g,
            потому что тогда m^n=1
            (поскольку все элементы подгруппы генерируют эту подгруппу, хотя и в другом порядке) <br/>
            Однако если это не так, вспомним, что gn=g0=1, поскольку подгруппа, порожденная g, циклична, так что<br/>
            h^(kn)=g^(xkn)=(g^n)^(xk)=1^(xk)=1 <br/>
            Получаем, что s2^n = m^n (modp).<br/>
            Используя предположение, что m = (m1)(m2): v^n=(m^n_1)(m^n_2) (modp) => (v^n)(m^−n_2)=m^n_1(modp)
        </p>
        добавть программу
    </div>

    <div id = "links" class="block">
        <h1 class = "title">Источники</h1>
        <p class = "text">
            Источники, которые мы использовали.
        </p>
        <ul class = "list">
            <li>
                <a href = "http://caislab.kaist.ac.kr/lecture/2010/spring/cs548/basic/B02.pdf">
                    <b>El Gamal T.</b> - A public key cryptosystem and a signature scheme based on discrete logarithms
                </a>
            </li>
            <li>
                <a href = "http://cyber.sibsutis.ru/%D0%A1%D0%9F%D0%98/%D0%9F%D0%B5%D1%80%D0%B2%D0%B0%D1%8F%20%D1%87%D0%B0%D1%81%D1%82%D1%8C/%D0%9A%D0%9C%D0%97%D0%98.pdf">
                    <b>Рябко, Фионов</b> - Криптографические методы защиты информации
                </a>
            </li>
            <li>
                <a href = "http://www.cacr.math.uwaterloo.ca/hac/about/chap11.pdf">
                    <b>Menezes A. J., Oorschot P. v., Vanstone S. A</b> - Handbook of Applied Cryptography
                </a>
            </li>
        </ul>
    </div>
    <footer>

    </footer>
    </div>
    <script src="js/modulo-example.js"></script>
    <script src="js/elgamal.js"></script>
    <script src="js/machines.js"></script>
  </body>
</html>
